<!doctype html>
<html lang="en">

  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>
    
      Plough => Ruby &middot; Journey through ruby
    
  </title>

  <link rel="stylesheet" href="/styles.css">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">
  <link rel="alternate" type="application/atom+xml" title="Plough => Ruby" href="/atom.xml">

  <!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Home" />
<meta name="author" content="andhapp" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Learning Ruby / Rails programming language" />
<meta property="og:description" content="Learning Ruby / Rails programming language" />
<link rel="canonical" href="http://localhost:4000/page5/" />
<meta property="og:url" content="http://localhost:4000/page5/" />
<meta property="og:site_name" content="Plough =&gt; Ruby" />
<link rel="prev" href="http://localhost:4000/page4" />
<link rel="next" href="http://localhost:4000/page6" />
<script type="application/ld+json">
{"url":"http://localhost:4000/page5/","@type":"WebPage","headline":"Home","author":{"@type":"Person","name":"andhapp"},"description":"Learning Ruby / Rails programming language","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>

    <div class="container content">
      <header class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">Plough => Ruby</a>
          <small>Journey through ruby</small>
        </h3>
      </header>

      <main>
        <div class="posts">
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2013/12/01/Mina-the-deployer/">
        Mina, the deployer
      </a>
    </h1>

    <time datetime="2013-12-01T00:00:00+00:00" class="post-date">01 Dec 2013</time>

    <p>I recently decided to setup a dedicated website for my company as opposed to just using my personal one. It’s a static site, with barely any content right now.</p>

<p>Now, I usually rely on capistrano for deployment, but since capistrano had recently undergone a major facelift, I sensed it as an opportunity to try <a href="https://github.com/nadarei/mina">Mina</a>. I have known about the gem since it’s very beginning, but the pressures of modern web developer life means less time for playing around, and more for getting things done. In other words, don’t change the deployer, if it ain’t broken.</p>

<p>Mina is very similar to Capistrano, except one small yet pivotal fact. Instead of running commands one-by-one over SSH, it creates a bash script from your configuration and executes it remotely as one SSH command. Sounds astute to me. It has the same configuration and deploy setup as Capistrano, and anyone with some Capistrano experience will pick it up pretty quickly.</p>

<p>One thing that really stuck out for me and propelled me to write this post is it’s reliance on the existing SSH set-up on your machine. For example, in Capistrano, one has to explicitly set up the ssh forward agent in the deploy script itself. But, in Mina, one just needs to specify forward agent in their SSH config, and Mina will pick that up. It’s quite logical, no idea why it wasn’t the case for Capistrano.</p>

<p>Anyways, hope this will motivate you guys to try Mina as well.</p>

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2013/04/10/dtrace-probes-in-ruby-2/">
        DTrace probes in Ruby 2 and a startling discovery
      </a>
    </h1>

    <time datetime="2013-04-10T00:00:00+01:00" class="post-date">10 Apr 2013</time>

    <p>DTrace is a static and dynamic instrumentation framework. I did a talk
at LRUG back in October on DTrace and it’s addition in Ruby 2. There’s
not much content in the presentation, but it will give you a little
pointers to the present situation of DTrace in general, and in Ruby.</p>

<p>The more I look into DTrace, the more I find it intriguing, challenging,
surprising, and yet thoroughly enjoyable. Recently, I was refactoring some 
of the tests for a project, and the test suite takes forever to run,
therefore, I decided to use Object.new for creating an instance of the
interested object (stub the requests). Another colleague came along and
commented…“Oh, why are you not using OpenStruct”. OpenStruct is handy,
as it has a hash like structre, which means a method call that hasn’t
been stubbed or instantiated will just return nil, just like a hash call
when the key is absent from the hash.</p>

<p>I ran some quick benchmarks and here are the results:</p>

<pre>
Calculating -------------------------------------
         Struct.new       7341 i/100ms
         Object.new      57600 i/100ms
     OpenStruct.new       5462 i/100ms
-------------------------------------------------
         Struct.new     90353.5 (±10.0%) i/s -     447801 in   5.017170s
         Object.new   2335283.3 (±3.2%) i/s -   11692800 in   5.012149s
     OpenStruct.new     65014.7 (±4.9%) i/s -     327720 in   5.053209s
</pre>

<p>One thing is obvious, if you don’t need the dynamic nature of an
OpenStruct, just use Object.new. This led me to think, why Object.new is
superfast as compared to Struct or OpenStruct. I wanted to see what
method calls is Struct or OpenStruct making, you know, just for my own
knowledge. I decided to use DTrace for that purpose. DTrace has been
added to Ruby 2, but I still couldn’t find any documentation. However, 
<a href="https://github.com/ruby/ruby/blob/trunk/probes.d">probes.d</a> file gives
a details of all the probe names, arguments in the probe and so on.
Please look at that file if you’d like to use DTrace with ruby.</p>

<p>I created a simple ruby file called <code class="highlighter-rouge">test.rb</code>, like this:</p>

<pre>
Object.new
</pre>

<p>and ran the following dtrace command on a Mac OS X:</p>

<pre>
sudo dtrace -c 'ruby test.rb' -Zn 'ruby*::method-entry { @[copyinstr(arg0)] = count(); }'
</pre>

<p>to receive the following output:</p>

<pre>
dtrace: description 'ruby*::method-entry ' matched 2 probes
dtrace: pid 14009 has exited

  Gem                                                              12
  Gem::Requirement                                                 23
  Gem::Version                                                     36
  Gem::Specification                                              267
  RbConfig                                                        309
</pre>

<p>Here column 1 is the Class name and the column 2 is the number of
times that class was accessed while running this ruby file. This was
quite surprising that RbConfig was accessed 309 times. Why? After much
thinking, I thought may be RVM has got a hand in this. I haven’t found a
solution yet.</p>

<p>I leave you here with this startling discovery and hope to solve
it for my next post. I’m planning to run the same dtrace command with
ruby installed via rbenv and see what I get and then go from there.</p>

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2013/04/08/openstruct-to-hash/">
        OpenStruct to hash
      </a>
    </h1>

    <time datetime="2013-04-08T00:00:00+01:00" class="post-date">08 Apr 2013</time>

    <p>OpenStruct is a handy class in ruby’s stdlib. I’ve used it in the past
for creating test data, instead of using factory girl. It’s fast, and
the fact that it behaves like a Hash, makes it super easy for stubbing
object behaviours.</p>

<p>The other day, I had this requirement to convert an open struct instance
into a hash. I foolishly tried to_hash call, considering that it acts as
a hash, so there must be a to_hash call on it. But, unfortunately, there
isn’t any to_hash methods on OpenStruct. However, there are other ways
to convert an open struct instance to a hash quite easily. Here’s how:</p>

<h3 id="option-1">Option 1</h3>
<pre>
os = OpenStruct.new(:id =&gt; 12)
os.marshal_dump # returns the hash {:id=&gt;12}
</pre>

<h3 id="option-2">Option 2</h3>
<pre>
os = OpenStruct.new(:id =&gt; 12)
os.instance_variable_get(:@table) # returns the hash {:id=&gt;12}
</pre>

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2013/02/23/inspect-to_s-change-in-ruby2/">
        In Ruby2, inspect independent of to_s
      </a>
    </h1>

    <time datetime="2013-02-23T00:00:00+00:00" class="post-date">23 Feb 2013</time>

    <p><a href="http://www.ruby-lang.org/en/news/2013/02/24/ruby-2-0-0-p0-is-released/">Ruby 2.0.0</a> has been released and there are a lot of new things, for example, keyword arguments, TracePoint API, DTrace and so on. Here’s <a href="https://github.com/ruby/ruby/blob/trunk/NEWS">Ruby NEWS</a> file, and some <a href="http://blog.marc-andre.ca/2013/02/23/ruby-2-by-example/">new features in Ruby 2</a>.</p>

<p>One thing to add to that list is that the behaviour of inspect is no
longer dependent on to_s. In Ruby 1.9, if to_s was overridden inspect
would just execute that code. But in Ruby 2.0, to_s overriding doesn’t
affect inspect anymore. Here’s code example for <a href="https://eval.in/11121">Ruby 1.9.3</a> and <a href="https://eval.in/11120">Ruby
2</a></p>

  </article>
  
  <article class="post">
    <h1 class="post-title">
      <a href="/2011/12/04/installing-any-ruby-source-on-your-local-machine-with-rvm/">
        Installing any Ruby source on your local machine with RVM
      </a>
    </h1>

    <time datetime="2011-12-04T00:00:00+00:00" class="post-date">04 Dec 2011</time>

    <p>Update:
<em>This approach doesn’t work with the latest version of rvm (1.17.0
stable)</em></p>

<p>Now, if you are like me you probably have ruby source checked out on your machine to ensure that you stay informed with the newest features and ponder through the ruby source at will. I started wondering what if I want to install the ruby from the source and test my gems out and test it against well-known libraries to see how they fare. Firstly, I thought of doing the ./configure -&gt; make -&gt; make install dance but then I realised…yes you’re absolutely right, why not use <a href="https://github.com/wayneeseguin/rvm">RVM</a>.</p>

<p>What RVM? I must be out of mind.</p>

<p>But, hey, RVM downloads ruby source code and installs it on your machine. The only difference is that I have got the ruby source checked-out on my machine and I want to use that as the source. And yes, RVM is awesome. I have spoken to <a href="https://github.com/wayneeseguin">Wayne</a> (via IRC) and the man is an absolute genius, very polite and helpful.</p>

<p>So, somehow, I need to accomplish the following:</p>

<ul>
  <li>Hey RVM, don’t download the ruby source.</li>
  <li>Here’s the location of the ruby source, use that and install it.</li>
  <li>Voila!</li>
</ul>

<p>But, how do I do that? I started looking at RVM source code and I am not an expert at bash scripting, so I figured why not just mail RVM mailing list. I got the following helpful response from <a href="https://github.com/mpapis">Micheal Papis</a>.</p>

<pre>
it's not yet supported to use sources/rubies provided by user, but it
will be in rvm 2.0

as for using it now, you could use $rvm_path/src - and provide your
sources there ... not sure how it will work, you have to experiment a
bit
</pre>

<p>That clue was enough for me and like he said, I experimented a little bit. When you run something like:</p>

<pre>
rvm install ruby-1.9.2
</pre>

<p>RVM downloads the source code into $rvm_path/repos, moves it over to $rvm_path/src and then does the configure, compile dance. I created a symlink in $rvm_path/repos pointing at the local ruby git repository on my machine. And, then I ran the install command. Here’s the output I get:</p>

<pre>
~/.rvm/src$ rvm install ruby-head
Installing Ruby from source to: /Users/andhapp/.rvm/rubies/ruby-head, this may take a while depending on your cpu(s)...

ruby-head - #fetching 
HEAD is now at 02035ba Merge branch 'trunk' of git://github.com/ruby/ruby into trunk

From github.com:andhapp/ruby
 * branch            trunk      -&gt; FETCH_HEAD
Already up-to-date.
Copying from repo to src path...
ruby-head - #configuring 
ruby-head - #compiling 
ruby-head - #installing 
Retrieving rubygems-1.8.10
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  243k  100  243k    0     0   456k      0 --:--:-- --:--:-- --:--:--  540k

Extracting rubygems-1.8.10 ...
Removing old Rubygems files...
-e:1: Use RbConfig instead of obsolete and deprecated Config.
Installing rubygems-1.8.10 for ruby-head ...
Installation of rubygems completed successfully.
ruby-head - adjusting #shebangs for (gem irb erb ri rdoc testrb rake).
ruby-head - #importing default gemsets (/Users/andhapp/.rvm/gemsets/)
Install of ruby-head - #complete 

</pre>

<p>This line ‘HEAD is now at 02035ba Merge branch ‘trunk’ of git://github.com/ruby/ruby into trunk’ is the last commit message on my local ruby git repository.</p>

<p>This line ‘From github.com:andhapp/ruby’ reflects the fact that rvm is using my git repository and not ruby’s repository and updating the local source to the latest before installing.</p>

<p>I decided to call the ruby installation ruby-head. You can call it anything you fancy.</p>

<p>Here’s the version on my machine now:</p>

<pre>
~/.rvm/src$ rvm use ruby-head
Using /Users/andhapp/.rvm/gems/ruby-head
~/.rvm/src$ ruby -v
ruby 2.0.0dev (2011-12-03 trunk 33936) [x86_64-darwin10.8.0]
</pre>

<p>Awesome!</p>

<p>PS: I am sure there are other details about RVM’s installation procedure that I have missed out and Wayne or Micheal will be kind enough to enlighten me.</p>


  </article>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page6">Older</a>
  
  
    <a class="pagination-item newer" href="/page4">Newer</a>
  
</div>

      </main>

      <footer class="footer">
        <small>
          &copy; <time datetime="2021-07-03T06:18:22+01:00">2021</time>. All rights reserved.
        </small>
      </footer>
    </div>

    
  </body>
</html>
