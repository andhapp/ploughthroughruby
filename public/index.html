
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Plough => Ruby</title>
  <meta name="author" content="andHapp">

  
  <meta name="description" content="Now, if you are like me you probably have ruby source checked out on your machine to ensure that you stay informed with the newest features and pon...">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="Plough => Ruby/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Plough => Ruby" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Plough => Ruby</a></h1>
  
    <h2>Journey through ruby</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:Plough => Ruby" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/12/04/installing-any-ruby-source-on-your-local-machine-with-rvm.html/">Installing Any Ruby Source on Your Local Machine With RVM</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-12-04T00:00:00+00:00" pubdate  data-updated="true" >Dec 4<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Now, if you are like me you probably have ruby source checked out on your machine to ensure that you stay informed with the newest features and ponder through the ruby source at will. I started wondering what if I want to install the ruby from the source and test my gems out and test it against well-known libraries to see how they fare. Firstly, I thought of doing the ./configure -> make -> make install dance but then I realised&#8230;yes you&#8217;re absolutely right, why not use <a href="https://github.com/wayneeseguin/rvm">RVM</a>.</p>

<p>What RVM? I must be out of mind.</p>

<p>But, hey, RVM downloads ruby source code and installs it on your machine. The only difference is that I have got the ruby source checked-out on my machine and I want to use that as the source. And yes, RVM is awesome. I have spoken to <a href="https://github.com/wayneeseguin">Wayne</a> (via IRC) and the man is an absolute genius, very polite and helpful.</p>

<p>So, somehow, I need to accomplish the following:</p>

<ul>
<li>Hey RVM, don&#8217;t download the ruby source.</li>
<li>Here&#8217;s the location of the ruby source, use that and install it.</li>
<li>Voila!</li>
</ul>


<p>But, how do I do that? I started looking at RVM source code and I am not an expert at bash scripting, so I figured why not just mail RVM mailing list. I got the following helpful response from <a href="https://github.com/mpapis">Micheal Papis</a>.</p>

<pre>
it's not yet supported to use sources/rubies provided by user, but it
will be in rvm 2.0

as for using it now, you could use $rvm_path/src - and provide your
sources there ... not sure how it will work, you have to experiment a
bit
</pre>


<p>That clue was enough for me and like he said, I experimented a little bit. When you run something like:</p>

<pre>
rvm install ruby-1.9.2
</pre>


<p>RVM downloads the source code into $rvm_path/repos, moves it over to $rvm_path/src and then does the configure, compile dance. I created a symlink in $rvm_path/repos pointing at the local ruby git repository on my machine. And, then I ran the install command. Here&#8217;s the output I get:</p>

<pre>
~/.rvm/src$ rvm install ruby-head
Installing Ruby from source to: /Users/andhapp/.rvm/rubies/ruby-head, this may take a while depending on your cpu(s)...

ruby-head - #fetching 
HEAD is now at 02035ba Merge branch 'trunk' of git://github.com/ruby/ruby into trunk

From github.com:andhapp/ruby
 * branch            trunk      -> FETCH_HEAD
Already up-to-date.
Copying from repo to src path...
ruby-head - #configuring 
ruby-head - #compiling 
ruby-head - #installing 
Retrieving rubygems-1.8.10
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  243k  100  243k    0     0   456k      0 --:--:-- --:--:-- --:--:--  540k

Extracting rubygems-1.8.10 ...
Removing old Rubygems files...
-e:1: Use RbConfig instead of obsolete and deprecated Config.
Installing rubygems-1.8.10 for ruby-head ...
Installation of rubygems completed successfully.
ruby-head - adjusting #shebangs for (gem irb erb ri rdoc testrb rake).
ruby-head - #importing default gemsets (/Users/andhapp/.rvm/gemsets/)
Install of ruby-head - #complete 

</pre>


<p>This line &#8216;HEAD is now at 02035ba Merge branch &#8216;trunk&#8217; of git://github.com/ruby/ruby into trunk&#8217; is the last commit message on my local ruby git repository.</p>

<p>This line &#8216;From github.com:andhapp/ruby&#8217; reflects the fact that rvm is using my git repository and not ruby&#8217;s repository and updating the local source to the latest before installing.</p>

<p>I decided to call the ruby installation ruby-head. You can call it anything you fancy.</p>

<p>Here&#8217;s the version on my machine now:</p>

<pre>
~/.rvm/src$ rvm use ruby-head
Using /Users/andhapp/.rvm/gems/ruby-head
~/.rvm/src$ ruby -v
ruby 2.0.0dev (2011-12-03 trunk 33936) [x86_64-darwin10.8.0]
</pre>


<p>Awesome!</p>

<p>PS: I am sure there are other details about RVM&#8217;s installation procedure that I have missed out and Wayne or Micheal will be kind enough to enlighten me.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/21/inconsistent-hashes.html/">Inconsistent Hashes</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-21T00:00:00+00:00" pubdate  data-updated="true" >Apr 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>To clarify, hashes here does not mean the Hash class. Object&#8217;s in ruby have a hash method that returns a hash code for an object. The hash is also used in the background by the eql? method. So, it&#8217;s safe to say that two objects are equal if their hash methods return the same value.</p>

<p>Now, carry out a simple exercise and see what happens. Fire up an IRB session and run the following code, one by one:</p>

<pre>
    "test".hash
    1.hash
    [].hash
</pre>


<p>And note the output after every command run. Now, exit out of IRB and start a fresh session and run the same piece of code again. This time you will see the hash values have changed completely. This might be a bit surprising but it has been implemented in Ruby 1.9 for security reasons as it avoids one from guessing hash values. I picked this up from Ruby-core ML discussion and hope you find it useful.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/04/17/an-interesting-ruby-method.html/">An Interesting Ruby Method</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-04-17T00:00:00+00:00" pubdate  data-updated="true" >Apr 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In this post, I will talk about a ruby method that I had no idea existed which might come handy in debugging your code.</p>

<p>The method I am talking about is <em>set_trace_func</em>. It&#8217;s part of the Kernel class and it does what it says. Allows one to set the method tracing on a method. The following snippet explains it further. Here, we have a class, TestingSetProcFunc:</p>

<pre>
    class TestingSetProcFunc
      def traceThisMethod
        source = 1
        target = 2
      end
    end
</pre>


<p>To inject set_trace_func in, it needs to be called before the method is invoked, like this:</p>

<pre>    
    puts "Event    File:Line                Id          Binding        Classname"
    set_trace_func proc { |event, file, line, id, binding, classname|
      printf "%8s %s:%-2d %20s %12s %8s\n", event, file, line, id, binding, classname
    }
</pre>


<p>It takes a proc with upto 6 arguments. These are the events with their brief descriptions:</p>

<ul>
<li>c-call (call a C-language routine)</li>
<li>c-return (return from a C-language routine)</li>
<li>call (call a Ruby method)</li>
<li>class (start a class or module definition)</li>
<li>end (finish a class or module definition)</li>
<li>line (execute code on a new line)</li>
<li>raise (raise an exception)</li>
<li>return (return from a Ruby method).</li>
</ul>


<p>Now, to run this we just need to call the method and look at the output:</p>

<pre>
    tracer = TestingSetProcFunc.new
    tracer.traceThisMethod
</pre>


<p>This is what the output will look like when you run it on the command line:</p>

<pre>    
Event    File:Line                Id          Binding        Classname
c-return test.rb:11       set_trace_func #<Binding:0x0b53c4>   Kernel
    line test.rb:13                      #<Binding:0x0b52fc>         
  c-call test.rb:13                  new #<Binding:0x0b525c>    Class
  c-call test.rb:13           initialize #<Binding:0x0b5144> BasicObject
c-return test.rb:13           initialize #<Binding:0x0b5090> BasicObject
c-return test.rb:13                  new #<Binding:0x0b4ff0>    Class
    line test.rb:14                      #<Binding:0x0b4f50>         
    call test.rb:2       traceThisMethod #<Binding:0x0b4eb0> TestingSetProcFunc
    line test.rb:3       traceThisMethod #<Binding:0x0b4dfc> TestingSetProcFunc
    line test.rb:4       traceThisMethod #<Binding:0x0b4d5c> TestingSetProcFunc
  return test.rb:5       traceThisMethod #<Binding:0x0b4cbc> TestingSetProcFunc    
</pre>


<p>This output gives one a good idea about the work that is happening in the background. The weird looking Binding instance is the context at that particular place in the code. I have just scratched the surface and I am sure there&#8217;s a lot one can do with this method. Have a look at the <a href="https://github.com/ruby/ruby/blob/trunk/test/ruby/test_settracefunc.rb">ruby&#8217;s test for set_trace_func</a> for more useful ways of employing it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/12/ruby-hacking-guide-chapter-1.html/">Ruby Hacking Guide - Chapter 1</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-03-12T00:00:00+00:00" pubdate  data-updated="true" >Mar 12<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have completed proof-reading and testing the code from old Ruby Hacking Guide and re-releases in the wild again. It still needs some styling work but I will hopefully find time to sort that out this week.</p>

<p>In the meantime, have a <a href="http://rubyhacking.andhapp.co.uk/2011/01/30/chapter-1.html">read through</a> and see if you spot any mistakes.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/03/12/free-ruby-1.9-online-book.html/">Free Ruby 1.9 Online Book</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-03-12T00:00:00+00:00" pubdate  data-updated="true" >Mar 12<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just found this nicely done online book on <a href="http://ruby.runpaint.org/">Ruby 1.9</a>, in particular. It&#8217;s a must see.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/21/ruby-file-append-mode.html/">Ruby File Append Mode</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-01-21T00:00:00+00:00" pubdate  data-updated="true" >Jan 21<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There are different file modes available to the developer when creating and opening new files in Ruby. One that I didn&#8217;t know about was &#8220;a&#8221; which basically means append to the end of the file rather than starting a new one. What could it be useful for? One example would be as a log file of some sort where one wants to preserve the old data and add new data to the end of the file. Very trivial but helpful if you know about these things. Just makes you a better developer.</p>

<p>A simple code example would be:</p>

<pre>
    file = File.new("datamapper.log", "a")  
</pre>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/17/ruby-hacking-guide.html/">Ruby Hacking Guide</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-01-17T00:00:00+00:00" pubdate  data-updated="true" >Jan 17<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I got hold of an out-of-date <a href="http://hawthorne-press.com/WebPage_RHG.html">Ruby Hacking Guide</a> and it looks very interesting. Therefore, in order to improve my understanding of Ruby internals, I have decided to spend time in reading it and the writing posts about it. The entire book can be downloaded in the form of HTML pages and might not make sense since some of it has been machine translated.</p>

<p>I hope my efforts are useful for anyone willing to venture into Ruby Internals.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/03/method-default-arguments-and-passing-nil-value.html/">Method Default Arguments and Passing Nil Value</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-01-03T00:00:00+00:00" pubdate  data-updated="true" >Jan 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>This is something very trivial and I kind of observed it whilst programming couple of weeks ago. For example, you had a method like this:</p>

<pre>
  class SomeClass
    def some_method(some_argument = '')
      raise ArgumentError unless some_argument
    end
  end
</pre>


<p>Now, I was under the impression that if I passed in a nil into this method, for some reason some_argument will still have the default value(&#8221;) as opposed to the nil value passed in but default arguments come into play when no value is passed in for the method arguments. But I was passing in nil which is an instance of NilClass and therefore some_argument gets assigned the nil value and an exception is raised.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2011/01/03/convert-array-to-hash-mystery.html/">Convert Array to Hash Mystery</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2011-01-03T00:00:00+00:00" pubdate  data-updated="true" >Jan 3<span>rd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>It is always easy to find solutions on Google but the real fun is in finding out how a bit of code works. It just helps you understand much more about the language and how it behaves. Converting an array to hash is easy. Just use this piece of code that I found on google:</p>

<pre>
  some_array = [1,2,3]
  some_hash = Hash[*(some_array.collect{|v| [v,v]}.flatten)] # yields {1=>1, 2=>2, 3=>3}
</pre>


<p>Few people have asked the question behind this conversion and I just decided to break it apart and tackle it bit by bit. Our objective, again, is to convert an array to a hash. Hash&#8217;s ruby documenation tells us that a new Hash object can be created by using even number of arguments. Something similar to the following code:</p>

<pre>
  some_hash = Hash[1,1,2,2,3,3] # This creates a hash object similar to this {1=>1, 2=>2, 3=>3}
</pre>


<p>All we need to do now is convert our some_array (defined in the first code snippet) and convert it into [1,1,2,2,3,3].</p>

<p>It&#8217;s simple really. We take the some_array and convert it into an array&#8217;s or array like this:</p>

<pre>
  some_array = [1,2,3]
  some_array.collect{|v| [v, v]} # will yield [[1,1], [2,2], [3,3]]
</pre>


<p>Now to convert it into [1,1,2,2,3,3] we just need to flatten this array of arrays like this:</p>

<pre>
  some_array = [1,2,3]
  some_array.collect{|v| [v, v]}.flatten # will yield [1,1,2,2,3,3]
</pre>


<p>Now, all we need to do is use the splat (*) unary operator. The splat operator expands the supplied array into individual arguments which is what we need to convert array into a hash. You could also achieve the same with the following snippet:</p>

<pre>
  some_array = [1,2,3]
  some_hash = Hash[*(some_array+some_array).sort] # yields {1=>1, 2=>2, 3=>3}
</pre>


<p>I hope you can work that out yourself. I hope this little discussion helped you.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2010/07/06/paperclip-and-rescue.html/">Paperclip and Rescue</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-07-06T00:00:00+00:00" pubdate  data-updated="true" >Jul 6<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Reading Open Source Code is probably the best way of learning new ways. Paperclip is an amazing file upload tool by brilliant guys at Thoughtbot. And yesterday, while going through their code I realised that <strong>rescue</strong> can be used as a statement modifier. For example, consider this block of code below:</p>

<pre>
  type = (self.path.match(/\.(\w+)$/)[1] rescue "octet-stream").downcase
</pre>


<p>What do you think happens here?
Its quite simple really. If the first statement (the match bit) raises and exception the second statement is executed instead.</p>

<p>Another way to write this would be:</p>

<pre>
  begin
    type = (self.path.match(/\.(\w+)$/)[1]).downcase
  rescue
    "octet-stream"
  end
</pre>

</div>
  
  


    </article>
  
  <nav class="pagination">
    <div>
      
        <a class="prev" href="/blog/page/2/">&larr; Older</a>
      
      <a href="/blog/archives">Blog Archives</a>
      
    </div>
  </nav>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2011/12/04/installing-any-ruby-source-on-your-local-machine-with-rvm.html/">Installing any Ruby source on your local machine with RVM</a>
      </li>
    
      <li class="post">
        <a href="/2011/04/21/inconsistent-hashes.html/">Inconsistent hashes</a>
      </li>
    
      <li class="post">
        <a href="/2011/04/17/an-interesting-ruby-method.html/">An Interesting Ruby Method</a>
      </li>
    
      <li class="post">
        <a href="/2011/03/12/ruby-hacking-guide-chapter-1.html/">Ruby Hacking Guide - Chapter 1</a>
      </li>
    
      <li class="post">
        <a href="/2011/03/12/free-ruby-1.9-online-book.html/">Free Ruby 1.9 Online Book</a>
      </li>
    
  </ul>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - andHapp -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>


  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-7379349-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>





</body>
</html>
